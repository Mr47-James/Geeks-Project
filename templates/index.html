{% extends "base.html" %}

{% block title %}Admin Dashboard | Harmony{% endblock %}

{% block content %}
<style>
    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
        animation: fadeInUp 0.8s ease;
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
    }

    .dashboard-subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        padding: 2rem;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        animation: fadeInUp 0.8s ease var(--delay, 0.2s) both;
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--gradient, var(--primary));
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        background: var(--gradient, var(--primary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 1.5rem;
        animation: pulse 2s infinite;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: block;
    }

    .stat-label {
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.9rem;
    }

    .quick-actions {
        margin-bottom: 3rem;
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-title i {
        color: #667eea;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .action-card {
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        color: var(--text-primary);
        animation: fadeInUp 0.8s ease var(--delay, 0.4s) both;
        position: relative;
        overflow: hidden;
    }

    .action-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient, var(--primary));
        opacity: 0.1;
        transition: left 0.3s ease;
    }

    .action-card:hover::before {
        left: 0;
    }

    .action-card:hover {
        transform: translateY(-5px);
        color: var(--text-primary);
        text-decoration: none;
    }

    .action-icon {
        width: 50px;
        height: 50px;
        background: var(--gradient, var(--primary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 1.2rem;
        transition: transform 0.3s ease;
    }

    .action-card:hover .action-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .action-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .action-description {
        font-size: 0.9rem;
        color: var(--text-muted);
    }

    .recent-activity {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 3rem;
    }

    .activity-section {
        animation: fadeInUp 0.8s ease var(--delay, 0.6s) both;
    }

    .activity-list {
        max-height: 400px;
        overflow-y: auto;
        padding: 1.5rem;
    }

    .activity-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--glass-border);
        transition: all 0.3s ease;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-item:hover {
        background: var(--glass-bg);
        margin: 0 -1rem;
        padding: 1rem;
        border-radius: var(--border-radius-sm);
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        background: var(--gradient, var(--secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.9rem;
        flex-shrink: 0;
    }

    .activity-content {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .activity-meta {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .integration-status {
        padding: 2rem;
        text-align: center;
        animation: fadeInUp 0.8s ease 0.8s both;
    }

    .integration-icon {
        width: 80px;
        height: 80px;
        background: var(--warning);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: white;
        font-size: 2rem;
        animation: bounce 2s infinite;
    }

    .integration-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .integration-message {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
    }

    .integration-button {
        background: var(--warning);
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: var(--border-radius-sm);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .integration-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .recent-activity {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .actions-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 480px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .actions-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- Dashboard Header -->
<div class="dashboard-header">
    <h1 class="dashboard-title">Admin Dashboard</h1>
    <p class="dashboard-subtitle">Manage your music library and monitor system performance</p>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="glass-card stat-card" style="--delay: 0.2s; --gradient: var(--primary);">
        <div class="stat-icon">
            <i class="fas fa-music"></i>
        </div>
        <span class="stat-number">{{ total_tracks }}</span>
        <span class="stat-label">Total Tracks</span>
    </div>
    
    <div class="glass-card stat-card" style="--delay: 0.3s; --gradient: var(--secondary);">
        <div class="stat-icon">
            <i class="fas fa-microphone"></i>
        </div>
        <span class="stat-number">{{ total_artists }}</span>
        <span class="stat-label">Artists</span>
    </div>
    
    <div class="glass-card stat-card" style="--delay: 0.4s; --gradient: var(--accent);">
        <div class="stat-icon">
            <i class="fas fa-play"></i>
        </div>
        <span class="stat-number">{{ recent_tracks|length + popular_tracks|length }}</span>
        <span class="stat-label">Active Tracks</span>
    </div>
    
    <div class="glass-card stat-card" style="--delay: 0.5s; --gradient: var(--success);">
        <div class="stat-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <span class="stat-number">98%</span>
        <span class="stat-label">System Health</span>
    </div>
</div>

<!-- Quick Actions -->
<section class="quick-actions">
    <h2 class="section-title">
        <i class="fas fa-bolt"></i>
        Quick Actions
    </h2>
    <div class="actions-grid">
        <a href="{{ url_for('upload_tracks') }}" class="glass-card action-card" style="--delay: 0.4s; --gradient: var(--primary);">
            <div class="action-icon">
                <i class="fas fa-upload"></i>
            </div>
            <div class="action-title">Upload Music</div>
            <div class="action-description">Add new tracks to your library</div>
        </a>
        
        <a href="{{ url_for('tracks') }}" class="glass-card action-card" style="--delay: 0.5s; --gradient: var(--secondary);">
            <div class="action-icon">
                <i class="fas fa-list"></i>
            </div>
            <div class="action-title">Manage Tracks</div>
            <div class="action-description">Edit and organize your music</div>
        </a>
        
        <a href="{{ url_for('artists') }}" class="glass-card action-card" style="--delay: 0.6s; --gradient: var(--accent);">
            <div class="action-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="action-title">Manage Artists</div>
            <div class="action-description">View and edit artist profiles</div>
        </a>
        
        <a href="{{ url_for('stats') }}" class="glass-card action-card" style="--delay: 0.7s; --gradient: var(--success);">
            <div class="action-icon">
                <i class="fas fa-analytics"></i>
            </div>
            <div class="action-title">View Analytics</div>
            <div class="action-description">Monitor performance metrics</div>
        </a>
    </div>
</section>

<!-- Recent Activity -->
<div class="recent-activity">
    <div class="glass-card activity-section" style="--delay: 0.6s;">
        <h3 class="section-title">
            <i class="fas fa-clock"></i>
            Recent Tracks
        </h3>
        <div class="activity-list">
            {% for track in recent_tracks %}
            <div class="activity-item">
                <div class="activity-icon" style="background: var(--primary);">
                    <i class="fas fa-music"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ track.title }}</div>
                    <div class="activity-meta">
                        by {{ track.artist.name if track.artist else 'Unknown Artist' }} • 
                        {{ track.created_at.strftime('%b %d, %Y') if track.created_at }}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% if not recent_tracks %}
            <div class="activity-item">
                <div class="activity-icon" style="background: var(--warning);">
                    <i class="fas fa-info"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">No recent tracks</div>
                    <div class="activity-meta">Upload some music to get started</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="glass-card activity-section" style="--delay: 0.7s;">
        <h3 class="section-title">
            <i class="fas fa-fire"></i>
            Popular Tracks
        </h3>
        <div class="activity-list">
            {% for track in popular_tracks %}
            <div class="activity-item">
                <div class="activity-icon" style="background: var(--secondary);">
                    <i class="fas fa-star"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">{{ track.title }}</div>
                    <div class="activity-meta">
                        {{ track.play_count }} plays • {{ track.like_count }} likes
                    </div>
                </div>
            </div>
            {% endfor %}
            {% if not popular_tracks %}
            <div class="activity-item">
                <div class="activity-icon" style="background: var(--warning);">
                    <i class="fas fa-info"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">No popular tracks yet</div>
                    <div class="activity-meta">Tracks will appear here as they gain popularity</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Integration Status -->
<div class="glass-card integration-status">
    <div class="integration-icon">
        <i class="fas fa-plug"></i>
    </div>
    <h3 class="integration-title">External Integrations</h3>
    <p class="integration-message">{{ pending_integrations.message }}</p>
    <button class="integration-button" onclick="checkIntegrations()">
        <i class="fas fa-sync-alt"></i>
        Check Status
    </button>
</div>

<script>
    // Integration status check
    function checkIntegrations() {
        const button = document.querySelector('.integration-button');
        const originalText = button.innerHTML;
        
        button.innerHTML = '<span class="loading"></span> Checking...';
        button.disabled = true;
        
        // Simulate API call
        setTimeout(() => {
            button.innerHTML = '<i class="fas fa-check"></i> All Systems Online';
            button.style.background = 'var(--success)';
            
            // Show success message
            const flashContainer = document.querySelector('.flash-messages');
            const notification = document.createElement('div');
            notification.className = 'flash-message success';
            notification.innerHTML = '<i class="fas fa-check-circle"></i> Integration status updated successfully!';
            flashContainer.appendChild(notification);
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = 'var(--warning)';
                button.disabled = false;
                notification.remove();
            }, 3000);
        }, 2000);
    }

    // Add hover effects to stat cards
    document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            const icon = this.querySelector('.stat-icon');
            icon.style.transform = 'scale(1.1) rotate(5deg)';
        });
        
        card.addEventListener('mouseleave', function() {
            const icon = this.querySelector('.stat-icon');
            icon.style.transform = 'scale(1) rotate(0deg)';
        });
    });

    // Animate numbers on load
    function animateNumbers() {
        document.querySelectorAll('.stat-number').forEach(element => {
            const target = parseInt(element.textContent) || 0;
            if (target === 0) return;
            
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    element.textContent = target;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 30);
        });
    }

    // Start animations when page loads
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(animateNumbers, 500);
    });
</script>
{% endblock %}